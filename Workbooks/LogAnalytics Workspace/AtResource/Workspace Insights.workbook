{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "e3573799-27ef-4a2e-bf5b-62bbb4928c91",
            "version": "KqlParameterItem/1.0",
            "name": "DefaultSubscription_Internal",
            "type": 1,
            "isRequired": true,
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| take 1\r\n| project subscriptionId",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "dd40fb96-1319-4195-b788-3dd79aba1ea9",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "query": "summarize by subscriptionId\r\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)",
            "value": null,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "58e7fa93-9588-4aec-8bba-3879ef851948",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id\r\n",
            "value": [
              "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/noatestresourcegroup/providers/Microsoft.OperationalInsights/workspaces/noakupWS"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "3d2b20e1-f5c9-4f6a-b0c2-5fb8ad5fd4d6",
            "version": "KqlParameterItem/1.0",
            "name": "resourceGroup",
            "type": 1,
            "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| where id == \"{Workspace}\"\r\n| project resourceGroup",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "51f4ef42-018a-48b9-a561-39bc3fcf883c",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "value": {
              "durationMs": 86400000
            }
          },
          {
            "id": "7e6c3264-1340-433c-98e9-118b37dc1efa",
            "version": "KqlParameterItem/1.0",
            "name": "GiBperday",
            "type": 1,
            "description": "Shows Average per Day over selected Duration (GiB)",
            "query": "union withsource = tt *\r\n| where TimeGenerated > startofday({TimeRange:start}) and TimeGenerated < startofday({TimeRange:end})\r\n// Only look at chargeable Tables\r\n| where _IsBillable == True\r\n| summarize\r\nTotalGBytes =round(sum(_BilledSize/(1024*1024*1024)),2)\r\nby bin(TimeGenerated, 1d)//, Solution=tt\r\n| summarize round(avg(TotalGBytes),2)\r\n",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "50b0f196-12ab-46d9-9b90-5372d82216a1",
            "version": "KqlParameterItem/1.0",
            "name": "GiBtotal",
            "type": 1,
            "query": "union withsource = tt *\r\n| where TimeGenerated {TimeRange:query}\r\n// Only look at chargeable Tables\r\n| where _IsBillable == True\r\n| summarize TotalGBytes =round(sum(_BilledSize/(1024*1024*1024)),2)",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 17"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "9bd54326-1969-4acf-8b19-30ca2911e2f1",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Health",
            "subTarget": "Health",
            "style": "link"
          },
          {
            "id": "95790351-6000-4fdb-b16f-8c51b06443e9",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Usage",
            "subTarget": "Usage",
            "style": "link"
          },
          {
            "id": "37761705-f9c6-481f-acbd-cfd0555b5128",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Connected Resources",
            "subTarget": "Connected Resources",
            "style": "link"
          },
          {
            "id": "f2e130e4-7046-4577-adec-f9498f2b7348",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Query Audit",
            "subTarget": "Query Audit",
            "style": "link"
          },
          {
            "id": "d1ca3706-b8db-417c-a441-558a0f29a7bb",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Operations",
            "subTarget": "Operations",
            "style": "link"
          },
          {
            "id": "9ec18509-4326-4200-8ae1-033a0bf92928",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Settings & Change log",
            "subTarget": "Settings & Change log",
            "style": "link"
          }
        ]
      },
      "name": "Main tabs"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where '{Workspace:name}' has name\r\n| extend state = trim(' ', tostring(properties.provisioningState))\r\n\t\t,sku   = trim(' ', tostring(properties.sku.name))\r\n        ,skuUpdate = trim(' ', tostring(properties.sku.lastSkuUpdate))\r\n\t\t,retentionDays = trim(' ', tostring(properties.retentionInDays))\r\n\t\t,dailyquotaGB  = trim(' ', tostring(properties.workspaceCapping.dailyQuotaGb))\r\n| extend dailyquotaGB = iif(dailyquotaGB !=-1.0, dailyquotaGB,\"Not set\")\r\n| extend skuUpdate    = iif(strlen(skuUpdate) > 0, skuUpdate,\"Unknown\")\r\n| extend sentinel     = iif(toint(retentionDays) < 90,\"If you have Sentinel, you can change your retention to 90days (free)?\",\"\")\r\n| project ['Resource Group']=resourceGroup, location, ['Data Retention(days)']=retentionDays, ['Last known SKU update']=skuUpdate, ['Daily Data Cap']=dailyquotaGB, ['Licence']=sku, ['Notes'] = sentinel",
        "size": 4,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "visualization": "table",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Workspace Name"
          },
          "leftContent": {
            "columnMatch": "Resource Group"
          },
          "rightContent": {
            "columnMatch": "Daily Data Cap"
          },
          "secondaryContent": {
            "columnMatch": "Licence"
          },
          "showBorder": false,
          "size": "auto"
        },
        "graphSettings": {
          "type": 0
        },
        "mapSettings": {
          "locInfo": "AzureLoc",
          "labelSettings": "location",
          "locInfoColumn": "location"
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Settings & Change log"
      },
      "name": "query - 18"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let TableTrends=\r\nunion withsource=SourceTable *\r\n| where TimeGenerated {TimeRange:query}\r\n| make-series Trend = sum(_BilledSize) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SourceTable;\r\nTableTrends\r\n| join kind=inner (\r\n    union withsource=SourceTable *\r\n    | where TimeGenerated {TimeRange:query}\r\n    | summarize Entries = count(), TableSize = sum(_BilledSize), last_log = datetime_diff(\"second\",now(), max(TimeGenerated)), estimate = sumif(_BilledSize, _IsBillable==true) by SourceTable, _IsBillable\r\n    ) on SourceTable\r\n| project ['Table Name'] = SourceTable, ['Table Size (MB)'] = TableSize/1024/1024, ['Table Entries'] = Entries,\r\n          Trend, ['Last Record Received'] =  last_log, ['Is Billable'] = _IsBillable\r\n | order by ['Table Size (MB)']  desc\r\n\r\n ",
              "size": 0,
              "showAnalytics": true,
              "title": "Workspace Tables ({TimeRange:label})",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Table Name",
              "exportParameterName": "Table",
              "exportDefaultValue": "All Tables",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "blue"
                    },
                    "numberFormat": {
                      "unit": 38,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "orange"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Trend",
                    "formatter": 9,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "Last Record Received",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "IsBillable",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Size per Entry",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "orange"
                    },
                    "numberFormat": {
                      "unit": 36,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Trend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "redGreen"
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Table Name",
                    "label": ""
                  },
                  {
                    "columnId": "Table Entries",
                    "comment": "Count of Rows in the Table"
                  },
                  {
                    "columnId": "Trend"
                  },
                  {
                    "columnId": "Last Record Received",
                    "comment": "When did the last record arrive?"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Usage"
            },
            "name": "BillableTablesVolume",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union withsource=SourceTable *\r\n| where '{Table}' == \"All Tables\" or '{Table}' == SourceTable\r\n| summarize count() by bin(TimeGenerated, {TimeRange:grain}), Type\r\n| project Type, TimeGenerated, count_",
              "size": 1,
              "showAnalytics": true,
              "title": "{Table}: Log Count ({TimeRange:label})",
              "color": "blue",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Namespace",
              "exportParameterName": "Namespace",
              "exportDefaultValue": "All",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "areachart"
            },
            "customWidth": "50",
            "name": "TableIngestedLogsCount",
            "styleSettings": {
              "maxWidth": "50"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage\r\n| where DataType=='{Table}' or '{Table}'==\"All Tables\"\r\n| summarize BillableDataGB =sum(Quantity)/1000. by bin(TimeGenerated, {TimeRange:grain})\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "{Table}: Ingestion Volume (GB) ({TimeRange:label})",
              "color": "green",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "areachart"
            },
            "customWidth": "50",
            "name": "query - 6"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Usage"
      },
      "name": "Usage"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Heartbeat\n| project Computer \n| distinct Computer\n| order by Computer asc",
              "size": 1,
              "showAnalytics": true,
              "title": "Computers sending heartbeats",
              "timeContext": {
                "durationMs": 86400000
              },
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "Computer",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Computer",
                  "sortOrder": 1
                }
              ]
            },
            "customWidth": "50",
            "name": "Computers sending heartbeats"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union *\r\n| where _ResourceId != \"\" and isempty(_ResourceId)==false\r\n| summarize ['Log Count']=count() by Resource=_ResourceId, ['Table Name']=Type\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Log count by resource ({TimeRange:label})",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "table",
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "$gen_link_Resource_0",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_link_Resource_0",
                  "sortOrder": 1
                }
              ]
            },
            "customWidth": "50",
            "name": "LogCountByResource"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Connected Resources"
      },
      "name": "Connected Resources"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": []
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Performance"
      },
      "name": "Performance"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "<svg viewBox=\"0 0 16 16\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path d=\"M2.78 8.15h-.31l5.72 5.47 4.49-4.69h1.41L8.22 15 1.31 8.44a3.78 3.78 0 0 1-.49-.57 3.64 3.64 0 0 1-.38-.66h1.89l2.17-2.3 3.57 3.42 2.45-2.55L11.75 7l2.78-.06a3.41 3.41 0 0 0 .36-.94 3.11 3.11 0 0 0 .11-.87 3.06 3.06 0 0 0-.28-1.26 3.32 3.32 0 0 0-.72-1A3.27 3.27 0 0 0 11.68 2a3.24 3.24 0 0 0-1.16.23 4.12 4.12 0 0 0-.92.56 7.39 7.39 0 0 0-.81.78c-.26.29-.52.59-.8.89q-.43-.46-.84-.85a8.31 8.31 0 0 0-.85-.75 3.81 3.81 0 0 0-1-.54 2.86 2.86 0 0 0-1.16-.2 3.31 3.31 0 0 0-1.25.28 3.37 3.37 0 0 0-1 .72 3.2 3.2 0 0 0-.67 1A3.14 3.14 0 0 0 1 5.43a3.4 3.4 0 0 0 .11.76h-1A2.38 2.38 0 0 1 0 5.84v-.38a4.25 4.25 0 0 1 1.18-3 4.19 4.19 0 0 1 3-1.31 3.82 3.82 0 0 1 1.16.13 4.19 4.19 0 0 1 .95.38 6 6 0 0 1 .84.61c.27.24.55.51.84.79.28-.3.55-.57.81-.82a5.37 5.37 0 0 1 .81-.65 4.23 4.23 0 0 1 .94-.43A4 4 0 0 1 11.66 1a4.07 4.07 0 0 1 1.66.29 4.14 4.14 0 0 1 1.36.88 4.34 4.34 0 0 1 .94 1.32 4.32 4.32 0 0 1 .38 1.6 4.18 4.18 0 0 1-.24 1.48A4.12 4.12 0 0 1 15 7.88L11.35 8l-.8-.78L8.1 9.75 4.53 6.32z\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\">Resourch Health (not affected by the Time Range)\r\n</span> "
            },
            "customWidth": "50",
            "name": "Resource health title",
            "styleSettings": {
              "margin": "25px 0px -10px 0px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": "#### Operational Errors and Warnings ({TimeRange:label})"
            },
            "customWidth": "50",
            "name": "Operations title",
            "styleSettings": {
              "margin": "25px 0px -10px 0px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureHealthQuery/1.0\",\"queryType\":\"Detailed\"}",
              "size": 3,
              "queryType": 4,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Name",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Availability state",
                    "formatter": 11
                  },
                  {
                    "columnMatch": "Detailed status",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Reason type",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Title",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource group",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "ResourceHealth",
            "styleSettings": {
              "margin": "30px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Operation\r\n| where OperationStatus in (\"Warning\", \"Error\")\r\n| summarize arg_max(TimeGenerated, *) by OperationStatus, OperationCategory, Solution, Computer, Detail\r\n| project TimeGenerated, OperationStatus, OperationCategory, Solution, Computer, Detail\r\n| sort by TimeGenerated asc",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "No errors and warnings",
              "noDataMessageStyle": 3,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "OperationStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Warning",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Error",
                          "representation": "3",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "Detail"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "TimeGenerated"
                },
                "sortBy": [
                  {
                    "itemKey": "$gen_count_$gen_group_0",
                    "sortOrder": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "TimeGenerated"
                  },
                  {
                    "columnId": "OperationStatus",
                    "label": "Status"
                  },
                  {
                    "columnId": "OperationCategory",
                    "label": "Category"
                  },
                  {
                    "columnId": "Solution"
                  },
                  {
                    "columnId": "Computer"
                  },
                  {
                    "columnId": "Detail",
                    "label": "Details"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_count_$gen_group_0",
                  "sortOrder": 1
                }
              ]
            },
            "customWidth": "50",
            "name": "TopOperationalErrorsAndWarnings",
            "styleSettings": {
              "margin": "0"
            }
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "586286ff-0691-4610-b38f-c33d548503d7",
                  "cellValue": "{Resource}",
                  "linkTarget": "Resource",
                  "linkLabel": "Resource Health page >",
                  "subTarget": "resourcehealth",
                  "style": "link"
                }
              ]
            },
            "customWidth": "50",
            "name": "ResourceHealthLink",
            "styleSettings": {
              "margin": "30px"
            }
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "e339dbd6-d7f4-4498-a521-98d033b37a2f",
                  "cellValue": "http://google.com",
                  "linkTarget": "Url",
                  "linkLabel": "Operation table >",
                  "subTarget": "resourcehealth",
                  "style": "link"
                }
              ]
            },
            "customWidth": "0",
            "name": "OperationsTableLink",
            "styleSettings": {
              "margin": "30px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": " \r\n ---\r\n"
            },
            "customWidth": "100",
            "name": "Separator line",
            "styleSettings": {
              "margin": "25px 0px -10px 0px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": "### Ingestion Latency ({TimeRange:label})\r\n*excluding Usage and Custom logs"
            },
            "name": "IngestionLatencyTitle"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// ingestion latency (E2E) per data type\r\nlet IngestionTrends=\r\nunion withsource=SourceTable *\r\n| where SourceTable !endswith \"_CL\" and SourceTable != \"Usage\"\r\n| where TimeGenerated {TimeRange:query}\r\n| extend IngestionDurationSeconds = (ingestion_time()-TimeGenerated)/1s \r\n| make-series Trend = avg(IngestionDurationSeconds) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SourceTable;\r\nIngestionTrends\r\n| join kind=inner (\r\n    union withsource=SourceTable *\r\n    | where TimeGenerated {TimeRange:query}\r\n    | extend IngestionDurationSeconds = (ingestion_time()-TimeGenerated)/1s \r\n    | summarize MedianIngestion=percentiles(IngestionDurationSeconds, 50), 90thPercentileIngestion=percentiles(IngestionDurationSeconds, 90) by SourceTable\r\n) on SourceTable\r\n| project ['Table Name'] = SourceTable, ['Median Latency (seconds)'] = MedianIngestion, ['90th Percentile Latency (seconds)'] = 90thPercentileIngestion, Trend\r\n| order by ['90th Percentile Latency (seconds)']  desc\r\n",
              "size": 3,
              "showAnalytics": true,
              "title": "End-to-end Latency (Agent and Pipeline)",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Median Latency (seconds)",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redDark"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "90th Percentile Latency (seconds)",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "red"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Trend",
                    "formatter": 9,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "Median Ingestion (seconds)",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redDark"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "90th Percentile Ingestion time (seconds)",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "red"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  }
                ]
              }
            },
            "customWidth": "55",
            "name": "Ingestion latency 90th percentile by data type",
            "styleSettings": {
              "margin": "30px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Agent latency\r\nlet IngestionTrends=\r\nunion withsource=SourceTable *\r\n| where SourceTable !endswith \"_CL\" and SourceTable != \"Usage\"\r\n| where TimeGenerated {TimeRange:query}\r\n| extend AgentLatencySeconds = (_TimeReceived-TimeGenerated)/1s\r\n| make-series Trend = avg(AgentLatencySeconds) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SourceTable;\r\nIngestionTrends\r\n| join kind=inner (\r\n    union withsource=SourceTable * \r\n    | where SourceTable !endswith \"_CL\" and SourceTable != \"Usage\"    // excluding Custom logs and Usage data\r\n    | extend AgentLatencySeconds = (_TimeReceived-TimeGenerated)/1s \r\n    | summarize MedianAgentLatency=percentiles(AgentLatencySeconds, 50), 90thPercentileAgentLatency=percentiles(AgentLatencySeconds, 90) by SourceTable\r\n) on SourceTable\r\n| project ['Table Name'] = SourceTable, ['Median Agent Latency (seconds)'] = MedianAgentLatency, ['90th Percentile Agent Latency (seconds)'] = 90thPercentileAgentLatency, Trend\r\n| order by ['90th Percentile Agent Latency (seconds)']  desc",
              "size": 3,
              "showAnalytics": true,
              "title": "Agent latecy",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Median Agent Latency (seconds)",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "purple"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "90th Percentile Agent Latency (seconds)",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "magenta"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Trend",
                    "formatter": 9,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "Agent latecy",
            "styleSettings": {
              "margin": "30px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Pipeline latency\r\n// Agent latency\r\nlet IngestionTrends=\r\nunion withsource=SourceTable *\r\n| where SourceTable !endswith \"_CL\" and SourceTable != \"Usage\"\r\n| where TimeGenerated {TimeRange:query}\r\n| extend PipeLineLatencySeconds = (ingestion_time()-_TimeReceived)/1s \r\n| make-series Trend = avg(PipeLineLatencySeconds) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SourceTable;\r\nIngestionTrends\r\n| join kind=inner (\r\n    union withsource=SourceTable * \r\n    | where SourceTable !endswith \"_CL\" and SourceTable != \"Usage\"    // excluding Custom logs and Usage data\r\n    | extend PipeLineLatencySeconds = (ingestion_time()-_TimeReceived)/1s \r\n    | summarize MedianPipelineLatency=percentile(PipeLineLatencySeconds, 50), 90thPercentilePipelineLatency=percentiles(PipeLineLatencySeconds, 90) by SourceTable\r\n) on SourceTable\r\n| project ['Table Name'] = SourceTable, ['Median Pipeline Latency (seconds)'] = MedianPipelineLatency, ['90th Percentile Pipeline Latency (seconds)'] = 90thPercentilePipelineLatency, Trend\r\n| order by ['90th Percentile Pipeline Latency (seconds)']  desc",
              "size": 3,
              "showAnalytics": true,
              "title": "Pipeline Latency",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Median Pipeline Latency (seconds)",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumSignificantDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "90th Percentile Pipeline Latency (seconds)",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blueDark"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Trend",
                    "formatter": 9,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "Pipeline Latency",
            "styleSettings": {
              "margin": "30px"
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Health"
      },
      "name": "Health"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| summarize Average=avg(ResponseDurationMs), Maximum=max(ResponseDurationMs), Median=percentiles(ResponseDurationMs, 50) by bin(TimeGenerated,{TimeRange:grain})\r\n| render timechart",
              "size": 1,
              "title": "Query Duration (ms)",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/LogAnalyticsUITelemetry/providers/Microsoft.OperationalInsights/workspaces/LAUXTelemetryLogsWorkspace",
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/noatestresourcegroup/providers/Microsoft.OperationalInsights/workspaces/noakupWS"
              ]
            },
            "name": "QueryDuration"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| summarize Average=avg(ResponseRowCount), Maximum=max(ResponseRowCount), Median=percentiles(ResponseRowCount, 50) by bin(TimeGenerated, {TimeRange:grain})\r\n| render timechart",
              "size": 1,
              "title": "Number of Rows Returned",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/LogAnalyticsUITelemetry/providers/Microsoft.OperationalInsights/workspaces/LAUXTelemetryLogsWorkspace",
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/noatestresourcegroup/providers/Microsoft.OperationalInsights/workspaces/noakupWS"
              ]
            },
            "name": "QueryRows"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| summarize count() by tostring(ResponseCode)\r\n| render piechart",
              "size": 1,
              "title": "Response Codes",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/LogAnalyticsUITelemetry/providers/Microsoft.OperationalInsights/workspaces/LAUXTelemetryLogsWorkspace",
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/noatestresourcegroup/providers/Microsoft.OperationalInsights/workspaces/noakupWS"
              ]
            },
            "customWidth": "50",
            "name": "ResponseCodes"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| top-hitters 20 of QueryText by ResponseDurationMs\r\n| extend idx = indexof(QueryText,split(QueryText,\";\")[2])\r\n| extend purequerytext= substring(QueryText,idx)\r\n| project-away QueryText, idx",
              "size": 0,
              "title": "Top 20 slowest queries",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/LogAnalyticsUITelemetry/providers/Microsoft.OperationalInsights/workspaces/LAUXTelemetryLogsWorkspace",
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/noatestresourcegroup/providers/Microsoft.OperationalInsights/workspaces/noakupWS"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "approximate_sum_ResponseDurationMs",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "orange"
                    }
                  },
                  {
                    "columnMatch": "purequerytext",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true,
                      "customColumnWidthSetting": "160ch"
                    }
                  },
                  {
                    "columnMatch": "QueryText",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "approximate_sum_ResponseDurationMs",
                    "label": "Response Duration (ms)"
                  },
                  {
                    "columnId": "purequerytext",
                    "label": "Query Text"
                  }
                ]
              }
            },
            "name": "SlowestQueries"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| top 10 by StatsCPUTimeMs desc nulls last\r\n| extend purequerytext= split(QueryText, \";\")[2]\r\n| extend idx = indexof(QueryText,split(QueryText,\";\")[2])\r\n| project StatsCPUTimeMs, StatsDataProcessedKB, substring(QueryText,idx)",
              "size": 0,
              "showAnalytics": true,
              "title": "Top 10 resource intensive queries ",
              "timeContext": {
                "durationMs": 86400000
              },
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/LogAnalyticsUITelemetry/providers/Microsoft.OperationalInsights/workspaces/LAUXTelemetryLogsWorkspace",
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/noatestresourcegroup/providers/Microsoft.OperationalInsights/workspaces/noakupWS"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "StatsCPUTimeMs",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redBright"
                    }
                  },
                  {
                    "columnMatch": "Column1",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "purequerytext",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "160ch"
                    }
                  },
                  {
                    "columnMatch": "approximate_sum_ResponseDurationMs",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redBright",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "QueryText",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "90%"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "StatsCPUTimeMs",
                    "label": "CPU Time (ms)"
                  },
                  {
                    "columnId": "StatsDataProcessedKB",
                    "label": "Data Processed (kb)"
                  },
                  {
                    "columnId": "Column1",
                    "label": "Query Text"
                  }
                ]
              }
            },
            "name": "ResourceIntensiveQueries "
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| summarize count() by AADEmail\r\n| top 10 by count_\r\n",
              "size": 0,
              "showAnalytics": true,
              "title": "Queries by user",
              "timeContext": {
                "durationMs": 86400000
              },
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/LogAnalyticsUITelemetry/providers/Microsoft.OperationalInsights/workspaces/LAUXTelemetryLogsWorkspace",
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/noatestresourcegroup/providers/Microsoft.OperationalInsights/workspaces/noakupWS"
              ]
            },
            "customWidth": "50",
            "name": "QueriesByUser"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| where ResponseCode == \"429\"\r\n| summarize reqCount = count() by AADObjectId\r\n| order by reqCount desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Throttled users",
              "timeContext": {
                "durationMs": 86400000
              },
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/LogAnalyticsUITelemetry/providers/Microsoft.OperationalInsights/workspaces/LAUXTelemetryLogsWorkspace",
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/MeirSandbox/providers/Microsoft.OperationalInsights/workspaces/Contoso88",
                "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/noatestresourcegroup/providers/Microsoft.OperationalInsights/workspaces/noakupWS"
              ]
            },
            "customWidth": "50",
            "showPin": true,
            "name": "ThrottledUsers"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Query Audit"
      },
      "name": "QueryAudit"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/b1550e13-52b0-4ed1-8a7a-8929cee47022/resourceGroups/noatestresourcegroup/providers/Microsoft.OperationalInsights/workspaces/noakupWS"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}