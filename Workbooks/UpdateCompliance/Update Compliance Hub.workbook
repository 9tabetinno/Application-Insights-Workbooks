{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "67dcb2cb-14b1-4d77-b52b-f728abbf43a2",
            "version": "KqlParameterItem/1.0",
            "name": "mappedTenantId",
            "type": 1,
            "isGlobal": true,
            "query": "resources\r\n| take 1\r\n| project tenantId",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "7a2bb320-fa9c-45c8-bbf6-942c8b3a4b0e",
            "version": "KqlParameterItem/1.0",
            "name": "mappedSubscription",
            "type": 6,
            "isGlobal": true,
            "value": "",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "01c6d66e-3f87-4e8a-8be6-0accbe4f4036",
            "version": "KqlParameterItem/1.0",
            "name": "mappedWorkspace",
            "type": 5,
            "isGlobal": true,
            "query": "resources\r\n| where type == \"microsoft.operationalinsights/workspaces\"\r\n| where \"{mappedSubscription:subscriptionId}\" == subscriptionId\r\n| project name",
            "value": "OMS-UC-Test",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "3b134915-f09f-417c-9da3-532eaff1a593",
            "version": "KqlParameterItem/1.0",
            "name": "hasLogAnalyticsData",
            "type": 1,
            "isGlobal": true,
            "value": "true",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "2776722c-672e-4a35-9c4b-3d8e74c1083f",
            "version": "KqlParameterItem/1.0",
            "name": "_SnapshotTime",
            "type": 1,
            "description": "Time indicating the latest snapshot",
            "isRequired": true,
            "query": "UCClient\r\n| where TimeGenerated >= ago(7d)\r\n| summarize max(TimeGenerated)",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 2"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "<img src=\"https://admin.microsoft.com/images/EmptyState/EmptyState_illustration_admin-action_group-of-cards-with-pencil_200px.png\"\nstyle=\"display: block;width:30%;margin-left:auto;margin-right:auto;\">\n</img>\n<br></br>\n\n<h2 markdown=\"1\" style=\"display:block;text-align:center;margin-left:auto;margin-right:auto;\">\nWelcome to Update Compliance\n</h2>\n\n<p markdown=\"1\" style=\"display:block;width:45%;text-align:center;margin-left:auto;margin-right:auto;\">\nGet started with Update Compliance and begin monitoring your Windows updates. A policy, Azure AD and a Log Anaytics workspace are required. <a href=\"https://go.microsoft.com/fwlink/p/?linkid=2196482\" target='_blank'>Learn More</a>.\n</p>"
            },
            "name": "text - 2",
            "styleSettings": {
              "margin": "0",
              "padding": "50"
            }
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "nav",
              "links": [
                {
                  "id": "990a0852-8517-47ec-91c2-d8a3bb7e1134",
                  "cellValue": "community-workbooks/UpdateCompliance/Get started with Update Compliance",
                  "linkTarget": "WorkbookTemplate",
                  "linkLabel": "Get Started",
                  "style": "primary",
                  "workbookContext": {
                    "componentIdSource": "workbook",
                    "resourceIdsSource": "default",
                    "templateIdSource": "static",
                    "templateId": "community-workbooks/UpdateCompliance/Get started with Update Compliance",
                    "typeSource": "default",
                    "gallerySource": "default",
                    "locationSource": "default"
                  }
                }
              ]
            },
            "name": "links - 2",
            "styleSettings": {
              "padding": "0px 0px 0px 0px"
            }
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "mappedWorkspace",
        "comparison": "isEqualTo"
      },
      "customWidth": "100",
      "name": "PreonboardingGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "<img src=\"https://prod.msocdn.com/M365/admin-main/2022.6.9.5/45d61a60d22c9f6dfce067f9991d8c0b.svg\"\r\nstyle=\"display: block;width:30%;margin-left:auto;margin-right:auto;\">\r\n</img>\r\n<br></br>\r\n\r\n<h2 markdown=\"1\" style=\"display:block;text-align:center;margin-left:auto;margin-right:auto;\">\r\nWaiting for Update Compliance data\r\n</h2>\r\n\r\n<p markdown=\"1\" style=\"display:block;width:45%;text-align:center;margin-left:auto;margin-right:auto;\">\r\nYou’ve enrolled in Update Compliance, but we’re still processing your data as a first-time setup. This will typically take 24 hours. Check back soon!\r\n</p>"
            },
            "name": "text - 0"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibilities": [
        {
          "parameterName": "mappedWorkspace",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "hasLogAnalyticsData",
          "comparison": "isNotEqualTo",
          "value": "true"
        }
      ],
      "name": "WaitingForDataGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "loadType": "always",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "**Subscription**: {mappedSubscription:name} &nbsp;&nbsp; **Workspace**: {mappedWorkspace:name} &nbsp;&nbsp; <a href='community-workbooks/UpdateCompliance/Get%20started%20with%20Update%20Compliance'>Change the subscription or workspace</a>"
            },
            "name": "Sub_WS Information"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "b3f4c34c-d421-4373-a567-8e3b10e63235",
                  "cellValue": "currentWorkbook",
                  "linkTarget": "parameter",
                  "linkLabel": "Summary",
                  "subTarget": "Summary",
                  "style": "link"
                },
                {
                  "id": "a55effea-5f5f-45c2-89ea-8032affc3541",
                  "cellValue": "currentWorkbook",
                  "linkTarget": "parameter",
                  "linkLabel": "Quality Updates",
                  "subTarget": "QualityUpdates",
                  "style": "link"
                },
                {
                  "id": "4fa51e7a-596b-43fe-9137-f03b488224f1",
                  "cellValue": "currentWorkbook",
                  "linkTarget": "parameter",
                  "linkLabel": "Feature Updates",
                  "subTarget": "FeatureUpdates",
                  "style": "link"
                }
              ]
            },
            "name": "WorkbookTabControl"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "UCClient\r\n| extend Title = \"Total\"\r\n| extend SeeDeviceDistribution = \"See device distribution\"\r\n| summarize arg_max(TimeGenerated, *) by AzureADDeviceId\r\n| summarize TotalDevices=count() by SeeDeviceDistribution, Title\r\n",
                    "size": 4,
                    "title": "Enrolled devices",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "subtitleContent": {
                        "columnMatch": "Title",
                        "formatter": 1
                      },
                      "rightContent": {
                        "columnMatch": "TotalDevices",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "SeeDeviceDistribution",
                        "formatter": 7,
                        "formatOptions": {
                          "linkTarget": "WorkbookTemplate",
                          "bladeOpenContext": {
                            "bladeParameters": []
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "TotalEnrolledDevices"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let _SnapshotTime = datetime({_SnapshotTime});\r\nlet DeviceAlert = UCDeviceAlert\r\n| where TimeGenerated == _SnapshotTime\r\n| where AlertStatus == \"Active\";\r\nlet UpdateAlert = UCUpdateAlert\r\n| where TimeGenerated == _SnapshotTime\r\n| where AlertStatus == \"Active\"\r\n| where UpdateCategory == \"WindowsQualityUpdate\" or UpdateCategory == \"WindowsFeatureUpdate\";\r\nDeviceAlert\r\n| union (UpdateAlert)\r\n| extend Title = \"Errors\"\r\n| extend ViewDetail = \"View detail\"\r\n| summarize ActiveAlerts = count() by Title, ViewDetail",
                    "size": 4,
                    "title": "Active alerts",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "subtitleContent": {
                        "columnMatch": "Title",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "ActiveAlerts",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "3",
                              "text": ""
                            }
                          ]
                        }
                      },
                      "rightContent": {
                        "columnMatch": "ActiveAlerts",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "ViewDetail",
                        "formatter": 7,
                        "formatOptions": {
                          "linkTarget": "WorkbookTemplate"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "ActiveAlerts"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "UCClientReadinessStatus\r\n| summarize Capable = countif(ReadinessStatus == \"Capable\"), Total = count(), Title = \"Capable\", ViewDetail = \"View detail\"\r\n| extend CapableCount = Capable * 1.0 / Total",
                    "size": 4,
                    "title": "Windows 11 elibigility",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "subtitleContent": {
                        "columnMatch": "Title",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "ActiveAlerts",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": ""
                            }
                          ]
                        }
                      },
                      "rightContent": {
                        "columnMatch": "CapableCount",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "ViewDetail",
                        "formatter": 7,
                        "formatOptions": {
                          "linkTarget": "WorkbookTemplate"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "Win11Eligibility"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "name": "spacer text"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "UCClientUpdateStatus\r\n| join kind=innerunique UCClient on AzureADDeviceId\r\n| where UpdateCategory == \"WindowsQualityUpdate\"\r\n| summarize arg_max(TimeGenerated, *) by AzureADDeviceId\r\n| summarize SecurityUpdateStatus = count() by OSSecurityUpdateStatus\r\n",
                    "size": 3,
                    "title": "Overall security update status",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "chartSettings": {
                      "yAxis": [
                        "SecurityUpdateStatus"
                      ],
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Latest",
                          "color": "blue"
                        },
                        {
                          "seriesName": "NotLatest",
                          "label": "Not Latest",
                          "color": "orange"
                        },
                        {
                          "seriesName": "MultipleSecurityUpdatesMissing",
                          "label": "Multiple Security Updates Missing",
                          "color": "red"
                        }
                      ]
                    }
                  },
                  "name": "OverallSecurityUpdateStatusChart"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "paragraph",
                    "links": [
                      {
                        "id": "f3d59e76-ffb9-42a8-b912-b034e54167a4",
                        "linkTarget": "WorkbookTemplate",
                        "linkLabel": "View more details in quality updates",
                        "style": "link",
                        "workbookContext": {
                          "componentIdSource": "workbook",
                          "resourceIdsSource": "workbook",
                          "templateIdSource": "static",
                          "templateId": "community-workbooks/UpdateCompliance/Quality Updates",
                          "typeSource": "workbook",
                          "gallerySource": "workbook",
                          "locationSource": "default"
                        }
                      }
                    ]
                  },
                  "name": "links - 5",
                  "styleSettings": {
                    "margin": "0px 0px 0px 12px"
                  }
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibility": {
              "parameterName": "currentWorkbook",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "SummaryContentGroup",
            "styleSettings": {
              "margin": "0",
              "padding": "0"
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "template",
              "loadType": "always",
              "loadFromTemplateId": "community-workbooks/UpdateCompliance/Quality Updates",
              "items": [],
              "exportParameters": true
            },
            "conditionalVisibility": {
              "parameterName": "currentWorkbook",
              "comparison": "isEqualTo",
              "value": "QualityUpdates"
            },
            "name": "QualityUpdatesContentGroup"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "hasLogAnalyticsData",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "HubGroup"
    }
  ],
  "fallbackResourceIds": [
    "community-workbooks/UpdateCompliance/Update Compliance Hub"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}