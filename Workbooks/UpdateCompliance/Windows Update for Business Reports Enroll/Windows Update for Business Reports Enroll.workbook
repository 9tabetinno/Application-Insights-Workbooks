{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "7719ca02-764b-46f6-950e-c337283487a6",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Configure Windows Update for Business Reports",
            "style": "link"
          }
        ]
      },
      "name": "links - 2"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::tenant"
        ],
        "parameters": [
          {
            "id": "a1885817-5564-4de2-8148-7fb8d22f1e92",
            "version": "KqlParameterItem/1.0",
            "name": "TenantID",
            "type": 1,
            "query": "take 1\r\n| project tenantId",
            "crossComponentResources": [
              "value::tenant"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resources/tenants"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resources/tenants"
      },
      "name": "parameters - 4"
    },
    {
      "type": 1,
      "content": {
        "json": "&nbsp;<span style=\"font-weight:600\">Tenant ID</span>: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{TenantID}"
      },
      "name": "text - 3"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{SelectedSubscriptionId}"
        ],
        "parameters": [
          {
            "id": "1d81a910-8502-417e-9236-aba8e198de08",
            "version": "KqlParameterItem/1.0",
            "name": "SavedMapping",
            "type": 1,
            "isGlobal": true,
            "query": "{\"version\":\"MsGraphEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/beta/admin/windows/updates/resourceConnections/\",\"urlParams\":[],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"id\",\"columnType\":\"string\"},{\"path\":\"$.state\",\"columnid\":\"state\",\"columnType\":\"string\"},{\"path\":\"$.azureSubscriptionId\",\"columnid\":\"azureSubscriptionId\",\"columnType\":\"string\"},{\"path\":\"$.azureResourceGroupName\",\"columnid\":\"azureResourceGroupName\",\"columnType\":\"string\"},{\"path\":\"$.workspaceName\",\"columnid\":\"workspaceNam\",\"columnType\":\"string\"}]}}]}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 14
          },
          {
            "id": "b0c778bd-f15a-414c-84c1-422e7be23ac7",
            "version": "KqlParameterItem/1.0",
            "name": "SelectedSubscriptionId",
            "label": "Subscription",
            "type": 6,
            "isGlobal": true,
            "value": null,
            "typeSettings": {
              "additionalResourceOptions": [],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "c38abcb1-a383-4259-bf4f-a83fffc729cb",
            "version": "KqlParameterItem/1.0",
            "name": "SelectedWorkspaceName",
            "label": "Azure Log Analytics workspace",
            "type": 5,
            "isRequired": true,
            "isGlobal": true,
            "query": "resources\r\n| where type == \"microsoft.operationalinsights/workspaces\"\r\n| where \"{SelectedSubscriptionId:subscriptionId}\" == subscriptionId\r\n| project name",
            "crossComponentResources": [
              "{SelectedSubscriptionId}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "ca5c9e9c-02bd-4109-a794-c8962394ecfe",
            "version": "KqlParameterItem/1.0",
            "name": "SelectedResourceGroupName",
            "label": "Resource Group",
            "type": 1,
            "isGlobal": true,
            "query": "resources\r\n| where \"{SelectedSubscriptionId:subscriptionId}\" == subscriptionId\r\n| where \"{SelectedWorkspaceName:name}\" == name\r\n| join kind=inner (\r\n    resourcecontainers\r\n    | where type == \"microsoft.resources/subscriptions\"\r\n    | project subscriptionId, subscriptionName = name)\r\n    on subscriptionId\r\n| project subscriptionName, resourceGroup, name, type, tags",
            "crossComponentResources": [
              "{SelectedSubscriptionId}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "a69f61bd-28cb-4758-b4cc-67834e34d360",
            "version": "KqlParameterItem/1.0",
            "name": "SubscriptionId",
            "type": 1,
            "isGlobal": true,
            "query": "resources\r\n| take 1\r\n| project subscriptionId",
            "crossComponentResources": [
              "{SelectedSubscriptionId}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "formHorizontal",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters - 2"
    },
    {
      "type": 1,
      "content": {
        "json": "You must have a workspace to use Update Compliance. You can create one below. After clicking “Review + Create” please wait a few minutes and then refresh the page.",
        "style": "error"
      },
      "conditionalVisibility": {
        "parameterName": "SelectedWorkspaceName",
        "comparison": "isEqualTo"
      },
      "name": "text - 7",
      "styleSettings": {
        "margin": "20px 0px 50px 0px"
      }
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "paragraph",
        "links": [
          {
            "id": "3de873fb-86c0-4981-aea0-446eda0badbc",
            "linkTarget": "OpenBlade",
            "linkLabel": "Create new workspace",
            "preText": "",
            "postText": "",
            "style": "primary",
            "bladeOpenContext": {
              "bladeName": "CreateWorkspaceBladeV2",
              "extensionName": "Microsoft_OperationsManagementSuite_Workspace",
              "bladeParameters": []
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedWorkspaceName",
        "comparison": "isEqualTo"
      },
      "name": "links - 6"
    },
    {
      "type": 1,
      "content": {
        "json": "Click the “Save Settings” button to configure Windows Update for Business Reports for your organization. Configuration will typically take 24 hours, every time you change your subscription or workspace.",
        "style": "info"
      },
      "conditionalVisibility": {
        "parameterName": "SelectedWorkspaceName",
        "comparison": "isNotEqualTo"
      },
      "name": "text - 5",
      "styleSettings": {
        "margin": "20px 0px 50px 0px"
      }
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "paragraph",
        "links": [
          {
            "id": "69d8915e-3784-49f1-b9b3-5493fffd7cb9",
            "linkTarget": "MsGraphAction",
            "linkLabel": "Save settings",
            "style": "primary",
            "linkIsContextBlade": true,
            "workbookContext": {
              "componentIdSource": "workbook",
              "resourceIdsSource": "workbook",
              "templateIdSource": "static",
              "templateId": "",
              "typeSource": "workbook",
              "gallerySource": "workbook",
              "locationSource": "default",
              "passSpecificParams": true,
              "templateParameters": [
                {
                  "name": "_SelectedSubscriptionId",
                  "source": "parameter",
                  "value": "SubscriptionId"
                },
                {
                  "name": "_SelectedResourceGroupName",
                  "source": "parameter",
                  "value": "SelectedResourceGroupName"
                },
                {
                  "name": "_SelectedWorkspaceName",
                  "source": "parameter",
                  "value": "SelectedWorkspaceName"
                },
                {
                  "name": "SavedMapping",
                  "source": "parameter",
                  "value": "SavedMapping"
                }
              ]
            },
            "msGraphActionContext": {
              "path": "/beta/admin/windows/updates/resourceConnections/",
              "headers": [],
              "params": [],
              "body": "{\r\n\t\"@odata.type\": \"#microsoft.graph.windowsUpdates.operationalInsightsConnection\",\r\n    \"azureSubscriptionId\": \"{SelectedSubscriptionId:id}\",\r\n    \"azureResourceGroupName\": \"{SelectedResourceGroupName}\",\r\n    \"workspaceName\": \"{SelectedWorkspaceName}\"\r\n}",
              "httpMethod": "POST",
              "title": "Save configuration settings",
              "description": "Please click \"Confirm save\" below to finish your Windows Update for Business Reports configuration. Once the saving process has completed, please refresh the page to see your device data.",
              "runLabel": "Confirm save"
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedWorkspaceName",
        "comparison": "isNotEqualTo"
      },
      "name": "links - 1"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}