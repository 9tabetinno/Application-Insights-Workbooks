{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "95c423b6-142d-4aa4-bbe6-0d408498a3d7",
            "version": "KqlParameterItem/1.0",
            "name": "_ShowPills",
            "type": 1,
            "description": "Hide pills",
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "no"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 3"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "03761a72-d969-426b-ba54-d1e709610b2d",
            "version": "KqlParameterItem/1.0",
            "name": "_WorkbookContext",
            "label": "Workbook Context",
            "type": 1,
            "description": "Whether workbook is opened standalone or as part of the Hub.",
            "isRequired": true,
            "query": "print(\"Focused\")",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "value": ""
          },
          {
            "id": "f503a201-a9bd-4085-8862-22e2c0735ed4",
            "version": "KqlParameterItem/1.0",
            "name": "_SnapshotTime",
            "label": "Snapshot time",
            "type": 1,
            "description": "Time indicating the latest snapshot",
            "isRequired": true,
            "query": "UCClient\r\n| where TimeGenerated >= ago(7d)\r\n| summarize max(TimeGenerated)",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "value": ""
          },
          {
            "id": "1b83a70d-303d-49fa-80d5-f36ac5af7ad6",
            "version": "KqlParameterItem/1.0",
            "name": "_TargetBuild",
            "label": "Target Build",
            "type": 1,
            "description": "Set alerts for this Target Build",
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "value": ""
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "_OSVersion",
            "label": "Target Version",
            "type": 1,
            "description": "Target OS Version",
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "id": "48dc0814-6eb8-4083-bdcd-54caee036b9b",
            "value": ""
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "_TotalAlerts",
            "label": "Total Alerts",
            "type": 1,
            "description": "Number of alerts for this target build",
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "id": "d3353f14-fca8-461f-b9a6-1c33e874030c",
            "value": ""
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 4"
    },
    {
      "type": 1,
      "content": {
        "json": "## Alerts for target build: {_TargetBuild}"
      },
      "name": "text - 2"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "###### Select an Alert Name to view additional information."
                  },
                  "name": "text - 2",
                  "styleSettings": {
                    "margin": "10px 0px 0px 0px"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let _SnapshotTime = datetime({_SnapshotTime});\r\nlet _TargetBuild = \"{_TargetBuild}\";\r\nUCUpdateAlert\r\n| where TimeGenerated == _SnapshotTime\r\n| where TargetBuild == _TargetBuild\r\n| where AlertStatus == \"Active\" and UpdateCategory == \"WindowsQualityUpdate\"\r\n| summarize Devices=count() by AlertSubtype, AlertClassification\r\n| project-reorder AlertSubtype, AlertClassification, Devices",
                    "size": 1,
                    "exportedParameters": [
                      {
                        "fieldName": "AlertSubtype",
                        "parameterName": "_AlertSubtype"
                      },
                      {
                        "fieldName": "AlertClassification",
                        "parameterName": "_AlertClassification",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "Devices",
                        "parameterName": "_DevicesCount",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertClassification",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Error",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Devices",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "red"
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "1b4a162a-7463-4079-8697-1730c8349bba",
                        "version": "KqlParameterItem/1.0",
                        "name": "_AlertType",
                        "type": 1,
                        "isRequired": true,
                        "query": "let _AlertSubtype = \"{_AlertSubtype}\";\r\nlet _SnapshotTime = datetime({_SnapshotTime});\r\nUCUpdateAlert\r\n| where TimeGenerated >= _SnapshotTime\r\n| where AlertSubtype == _AlertSubtype\r\n| project AlertType\r\n| take 1",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "982ae0fb-cd0a-4541-9f3f-aa27ffbb5567",
                        "version": "KqlParameterItem/1.0",
                        "name": "_Description",
                        "type": 1,
                        "isRequired": true,
                        "query": "let _SnapshotTime = datetime({_SnapshotTime});\r\nlet _AlertSubtype = \"{_AlertSubtype}\";\r\nUCUpdateAlert\r\n| where TimeGenerated >= _SnapshotTime\r\n| where AlertSubtype == _AlertSubtype\r\n| project Description\r\n| take 1",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "8fd7315f-d6e0-4245-8b22-2634d704f117",
                        "version": "KqlParameterItem/1.0",
                        "name": "_Recommendation",
                        "type": 1,
                        "isRequired": true,
                        "query": "let _SnapshotTime = datetime({_SnapshotTime});\r\nlet _AlertSubtype = \"{_AlertSubtype}\";\r\nUCUpdateAlert\r\n| where TimeGenerated >= _SnapshotTime\r\n| where AlertSubtype == \"{_AlertSubtype}\"\r\n| project Recommendation\r\n| take 1",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "027322ff-80b2-4a50-946e-b7d78acd9f98",
                        "version": "KqlParameterItem/1.0",
                        "name": "_ErrorCode",
                        "type": 1,
                        "description": "Get error code for subtype alert",
                        "isRequired": true,
                        "query": "let _SnapshotTime = datetime({_SnapshotTime});\r\nlet _AlertSubtype = \"{_AlertSubtype}\";\r\nUCUpdateAlert\r\n| where TimeGenerated >= _SnapshotTime\r\n| where AlertSubtype == \"{_AlertSubtype}\"\r\n| where ErrorCode != \"\"\r\n| distinct ErrorCode\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "conditionalVisibility": {
                    "parameterName": "_ShowPills",
                    "comparison": "isNotEqualTo",
                    "value": "no"
                  },
                  "name": "parameters - 2 - Copy"
                }
              ],
              "exportParameters": true
            },
            "customWidth": "50",
            "name": "TopPane",
            "styleSettings": {
              "margin": "0px"
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### {_AlertSubtype}\r\n\r\n#### AlertType: \r\n{_AlertType}\r\n\r\n#### AlertSubtype: \r\n{_AlertSubtype}\r\n\r\n#### Description:\r\n{_Description}\r\n\r\n#### Recommendation: \r\n{_Recommendation}"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "_AlertClassification",
              "comparison": "isEqualTo",
              "value": "Warning"
            },
            "name": "WarningBox",
            "styleSettings": {
              "padding": "10px 20px",
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### {_AlertSubtype}\r\n\r\n#### AlertType: \r\n{_AlertType}\r\n\r\n#### AlertSubtype: \r\n{_AlertSubtype}\r\n\r\n#### Error Code:\r\n{_ErrorCode}\r\n\r\n#### Description:\r\n{_Description}\r\n\r\n#### Recommendation: \r\n{_Recommendation}"
                  },
                  "name": "text - 1"
                }
              ]
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "_AlertClassification",
              "comparison": "isEqualTo",
              "value": "Error"
            },
            "name": "ErrorBox-TextDesign",
            "styleSettings": {
              "padding": "10px 20px",
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "#### Devices for : {_AlertSubtype} ({_DevicesCount})"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Results were limited to the first 250 rows. To see all results click the “View in Log Analytics” or “Export to excel” buttons.",
                    "style": "warning"
                  },
                  "name": "text - 3"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "5e4e45c5-9222-4a21-839d-f07d08ed753b",
                              "version": "KqlParameterItem/1.0",
                              "name": "_ClientState",
                              "label": "ClientState",
                              "type": 2,
                              "description": "Filter by Client State",
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "let _SnapshotTime = datetime({_SnapshotTime});\r\nUCClientUpdateStatus\r\n| where TimeGenerated == datetime({_SnapshotTime})\r\n| where UpdateCategory == \"WindowsQualityUpdate\" and ClientState != \"\"\r\n| summarize by ClientState",
                              "value": [
                                "value::all"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "selectAllValue": "ALL",
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "ClientState",
                        "styleSettings": {
                          "padding": "-10px"
                        }
                      }
                    ],
                    "exportParameters": true
                  },
                  "customWidth": "50",
                  "name": "PillGroup"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let _SnapshotTime = datetime({_SnapshotTime});\r\nlet _AlertSubtype = \"{_AlertSubtype}\";\r\nlet _TargetBuild = \"{_TargetBuild}\";\r\nlet _ClientState = \"{_ClientState}\";\r\nlet DeviceAlerts = (UCUpdateAlert\r\n| join kind=leftouter UCClientUpdateStatus on AzureADDeviceId\r\n| where TimeGenerated == _SnapshotTime\r\n| where UpdateCategory == \"WindowsQualityUpdate\" and TargetBuild == _TargetBuild\r\n| where iff(_ClientState has \"ALL\", true, _ClientState has tostring(ClientState))\r\n| where AlertSubtype == _AlertSubtype and AlertStatus == \"Active\" \r\n| summarize arg_max(TimeGenerated, *) by AzureADDeviceId\r\n| summarize by AzureADDeviceId, DeviceName, ClientState, ClientSubstate);\r\nlet DeviceInfo = (UCClient\r\n| where TimeGenerated == _SnapshotTime\r\n| summarize by AzureADDeviceId, OSBuild, OSVersion);\r\nDeviceAlerts\r\n| join kind=leftouter DeviceInfo on AzureADDeviceId\r\n| project DeviceName, AzureADDeviceId,  OSVersion, OSBuild, ClientState, ClientSubstate\r\n| take 250\r\n\r\n\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "AzureADDeviceId",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "AzureADDeviceId",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "margin": "-60px 0px 0px 0px",
                    "padding": "0px"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "_AlertClassification",
              "comparison": "isEqualTo",
              "value": "Error"
            },
            "name": "BottomPane",
            "styleSettings": {
              "margin": "0px"
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "#### Devices for : {_AlertSubtype} ({_DevicesCount})"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Results were limited to the first 250 rows. To see all results click the “View in Log Analytics” or “Export to excel” buttons.",
                    "style": "warning"
                  },
                  "name": "text - 3"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "5e4e45c5-9222-4a21-839d-f07d08ed753b",
                              "version": "KqlParameterItem/1.0",
                              "name": "_ClientState",
                              "label": "ClientState",
                              "type": 2,
                              "description": "Filter by Client State",
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "let _SnapshotTime = datetime({_SnapshotTime});\r\nUCClientUpdateStatus\r\n| where TimeGenerated == datetime({_SnapshotTime})\r\n| where UpdateCategory == \"WindowsQualityUpdate\" and ClientState != \"\"\r\n| summarize by ClientState",
                              "value": [
                                "value::all"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "selectAllValue": "ALL",
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "ClientState",
                        "styleSettings": {
                          "padding": "-10px"
                        }
                      }
                    ],
                    "exportParameters": true
                  },
                  "customWidth": "50",
                  "name": "PillGroup"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let _SnapshotTime = datetime({_SnapshotTime});\r\nlet _AlertSubtype = \"{_AlertSubtype}\";\r\nlet _TargetBuild = \"{_TargetBuild}\";\r\nlet _ClientState = \"{_ClientState}\";\r\nlet DeviceAlerts = (UCUpdateAlert\r\n| join kind=leftouter UCClientUpdateStatus on AzureADDeviceId\r\n| where TimeGenerated == _SnapshotTime\r\n| where UpdateCategory == \"WindowsQualityUpdate\" and TargetBuild == _TargetBuild\r\n| where iff(_ClientState has \"ALL\", true, _ClientState has tostring(ClientState))\r\n| where AlertSubtype == _AlertSubtype and AlertStatus == \"Active\" \r\n| summarize arg_max(TimeGenerated, *) by AzureADDeviceId\r\n| summarize by AzureADDeviceId, DeviceName, ClientState, ClientSubstate);\r\nlet DeviceInfo = (UCClient\r\n| where TimeGenerated == _SnapshotTime\r\n| summarize by AzureADDeviceId, OSBuild, OSVersion);\r\nDeviceAlerts\r\n| join kind=leftouter DeviceInfo on AzureADDeviceId\r\n| project DeviceName, AzureADDeviceId,  OSVersion, OSBuild, ClientState, ClientSubstate\r\n| take 250\r\n\r\n\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "AzureADDeviceId",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "AzureADDeviceId",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "margin": "-60px 0px 0px 0px",
                    "padding": "0px"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "_AlertClassification",
              "comparison": "isEqualTo",
              "value": "Warning"
            },
            "name": "BottomPaneWarning"
          }
        ],
        "exportParameters": true
      },
      "name": "group - 1",
      "styleSettings": {
        "showBorder": true
      }
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}