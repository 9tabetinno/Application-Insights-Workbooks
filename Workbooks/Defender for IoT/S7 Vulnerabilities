{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# SIMATIC S7-1200 and S7-1500 CPU vulnerability detection\r\n#### Siemens recently published a security bulletin regarding a vulnerability in the S7-1200 and S7-1500 family of PLCs.\r\nAn attacker can use this exploit to gain full control of a PLC, conferring the following capabilities to the threat actor:\r\n- Connect to the PLC\r\n- Change the PLC’s configuration\r\n- Upload Ladder logic to the PLC\r\n- Change PLC mode\r\n\r\n**Attackers abusing this vulnerability can decrypt encrypted information such as passwords.**\r\n\r\n## The following workbook will summarize vulnerable devices in your inventory\r\n\r\nWe recommend following the [mitigation guidelines](https://cert-portal.siemens.com/productcert/html/ssa-568427.html) published by Siemens. To download the firmware updates for S7-1200 directly, please [click here](https://support.industry.siemens.com/cs/document/109793280/release-s7-1200-cpu-firmware-version-v4-5?lc=en-ww), and for S7-1500, [click here](https://support.industry.siemens.com/cs/document/109478459/firmware-update-s7-1500-cpus-incl-displays-and-et-200-cpus-(et-200sp-et-200pro).  \r\n"
      },
      "name": "text - 1"
    },
    {
      "type": 1,
      "content": {
        "json": "## S7-1200 vulnerable devices"
      },
      "customWidth": "30",
      "name": "text - 2",
      "styleSettings": {
        "maxWidth": "30"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "iotsecurityresources\r\n| where type == \"microsoft.iotsecurity/locations/devicegroups/devices\"\r\n| extend SubType=properties.deviceSubTypeDisplayName\r\n| extend model=properties['hardware']['model']\r\n| extend vendor=properties['hardware']['vendor']\r\n| extend lastSeen=properties.lastSeen\r\n| extend Firmwares=properties.firmwares\r\n| extend Name=properties.deviceName\r\n| where properties['isLocalSubnet'] == 'true'\r\n| extend protocols =properties['protocols']\r\n| extend site=properties['sensor']['site']\r\n| extend sensor=properties['sensor']['name']\r\n|mv-expand Firmwares\r\n| extend firmwareVersion=Firmwares.version\r\n| where Firmwares contains \"6ES7 211-1HE40-0XB0\" or model contains \"6ES7 212-1AE40-0XB0\" or model contains \"6ES7 212-1BE40-0XB0\" or model contains \"6ES7 212-1HE40-0XB0\" or model contains \"6ES7 214-1AG40-0XB0\" or model contains \"6ES7 214-1BG40-0XB0\" or model contains \"6ES7 214-1HG40-0XB0\" or model contains \"6ES7 215-1AG40-0XB0\" or model contains \"6ES7 215-1BG40-0XB0\" or model contains \"6ES7 215-1HG40-0XB0\" or model contains \"6ES7 217-1AG40-0XB0\" or model contains \"6ES7 212-1AF40-0XB0\" or model contains \"6ES7 212-1HF40-0XB0\" or model contains \"6ES7 214-1AF40-0XB0\" or model contains \"6ES7 214-1HF40-0XB0\" or model contains \"6ES7 215-1AF40-0XB0\"\r\n| where firmwareVersion !contains \"4.5\"\r\n| project site, sensor, Name, SubType, vendor, model, firmwareVersion\r\n",
        "size": 0,
        "title": "S7-1200 - Vulnerable devices",
        "showExportToExcel": true,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "gridSettings": {
          "labelSettings": [
            {
              "columnId": "site",
              "label": "Site"
            },
            {
              "columnId": "sensor",
              "label": "Sensor"
            },
            {
              "columnId": "SubType",
              "label": "Type"
            },
            {
              "columnId": "vendor",
              "label": "Vendor"
            },
            {
              "columnId": "model",
              "label": "Model"
            },
            {
              "columnId": "firmwareVersion",
              "label": "Firmware version"
            }
          ]
        }
      },
      "name": "S7-1200"
    },
    {
      "type": 1,
      "content": {
        "json": "## S7-1500 vulnerable devices"
      },
      "customWidth": "30",
      "name": "S7-1500",
      "styleSettings": {
        "maxWidth": "30"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "iotsecurityresources\r\n| where type == \"microsoft.iotsecurity/locations/devicegroups/devices\"\r\n| extend SubType=properties.deviceSubTypeDisplayName\r\n| extend model=properties['hardware']['model']\r\n| extend vendor=properties['hardware']['vendor']\r\n| extend lastSeen=properties.lastSeen\r\n| extend Firmwares=properties.firmwares\r\n| extend Name=properties.deviceName\r\n| where properties['isLocalSubnet'] == 'true'\r\n| extend protocols =properties['protocols']\r\n| extend site=properties['sensor']['site']\r\n| extend sensor=properties['sensor']['name']\r\n|mv-expand Firmwares\r\n| extend firmwareVersion=Firmwares.version\r\n| where Firmwares  contains \"510-1DJ01-0AB0\" or Firmwares contains \"510-1SJ01-0AB0\" or Firmwares contains \"511-1AK01-0AB0\" or Firmwares contains \"511-1AK02-0AB0\" or Firmwares contains \"511-1CK00-0AB0\" or Firmwares contains \"511-1CK01-0AB0\" or Firmwares contains \"511-1FK01-0AB0\" or Firmwares contains \"511-1FK02-0AB0\" or Firmwares contains \"511-1TK01-0AB0\" or Firmwares contains \"511-1UK01-0AB0\" or Firmwares contains \"512-1CK00-0AB0\" or Firmwares contains \"512-1CK01-0AB0\" or Firmwares contains \"512-1DK01-0AB0\" or Firmwares contains \"512-1SK01-0AB0\" or Firmwares contains \"513-1AL01-0AB0\" or Firmwares contains \"513-1AL02-0AB0\" or Firmwares contains \"513-1FL01-0AB0\" or Firmwares contains \"513-1FL02-0AB0\" or Firmwares contains \"513-2PL00-0AB0\" or Firmwares contains \"513-2GL00-0AB0\" or Firmwares contains \"513-1RL00-0AB0\" or Firmwares contains \"515-2AM01-0AB0\" or Firmwares contains \"515-2AM02-0AB0\" or Firmwares contains \"515-2FM01-0AB0\" or Firmwares contains \"515-2FM02-0AB0\" or Firmwares contains \"515-2RM00-0AB0\" or Firmwares contains \"515-2TM01-0AB0\" or Firmwares contains \"515-2UM01-0AB0\" or Firmwares contains \"516-3AN01-0AB0\" or Firmwares contains \"516-3AN02-0AB0\" or Firmwares contains \"516-3FN01-0AB0\" or Firmwares contains \"516-3FN02-0AB0\" or Firmwares contains \"516-2PN00-0AB0\" or Firmwares contains \"516-2GN00-0AB0\" or Firmwares contains \"516-3TN00-0AB0\" or Firmwares contains \"516-3UN00-0AB0\" or Firmwares contains \"517-3AP00-0AB0\" or Firmwares contains \"517-3FP00-0AB0\" or Firmwares contains \"517-3HP00-0AB0\" or Firmwares contains \"517-3TP00-0AB0\" or Firmwares contains \"517-3UP00-0AB0\" or Firmwares contains \"518-4AP00-0AB0\" or Firmwares contains \"518-4FP00-0AB0\" or Firmwares contains \"518-4JP00-0AB0\" or Firmwares contains \"518-4TP00-0AB0\" or Firmwares contains \"518-4UP00-0AB0\" or Firmwares contains \"518-4AP00-3AB0\" or Firmwares contains \"518-4FP00-3AB0\" or Firmwares contains \"518-4AX00-1AB0\" or Firmwares contains \"518-4FX00-1AB0\" or Firmwares contains \"518-4AX00-1AC0\" or Firmwares contains \"518-4FX00-1AC0\"\r\n| where Firmwares !contains '2.9.2'\r\n| where Firmwares !contains '2.9.3'\r\n| where Firmwares !contains '2.9.4'\r\n| project site, sensor, Name, SubType, vendor, model, firmwareVersion",
        "size": 0,
        "title": "S7-1500 - Vulnerable devices",
        "showExportToExcel": true,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "gridSettings": {
          "labelSettings": [
            {
              "columnId": "site",
              "label": "Site"
            },
            {
              "columnId": "sensor",
              "label": "Sensor"
            },
            {
              "columnId": "SubType",
              "label": "Type"
            },
            {
              "columnId": "vendor",
              "label": "Vendor"
            },
            {
              "columnId": "model",
              "label": "Model"
            },
            {
              "columnId": "firmwareVersion",
              "label": "Firmware version"
            }
          ]
        }
      },
      "name": "S7-1500"
    }
  ],
  "fallbackResourceIds": [
    "defender-for-iot"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
